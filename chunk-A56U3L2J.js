import{a as L}from"./chunk-SSXHNV2Q.js";import{a as H}from"./chunk-ETO6KYMO.js";import{a as $}from"./chunk-5Y55KLY7.js";import{a as z}from"./chunk-SMIQJOBS.js";import{b as T,c as u,d as K,e as D,f as w,g as O,h as V,i as B,j as A,k as q,l as G,m as P,o as R,p as j}from"./chunk-UKXJF3TO.js";import"./chunk-YCMZOG5D.js";import{b as y,d as N}from"./chunk-ZN2XXCIA.js";import{$a as F,Fa as I,Ib as E,Ja as s,Jb as k,Lb as M,Ua as l,Va as r,Wa as i,Xa as g,Y as b,Z as _,ab as h,bb as f,hb as n,ib as C,jb as x,kb as S,ua as a,za as p}from"./chunk-CFCTFSSM.js";function Q(o,t){if(o&1&&(r(0,"div",6),n(1),i()),o&2){let e=f();a(),C(e.error)}}function U(o,t){o&1&&(r(0,"div",7),n(1,"Cargando datos..."),i())}function W(o,t){if(o&1&&(r(0,"option",31),n(1),i()),o&2){let e=t.$implicit;l("value",e.id),a(),x(" ",e.nombre," ")}}function X(o,t){o&1&&(r(0,"div",32),n(1," Bodega es requerida "),i())}function Y(o,t){if(o&1&&(r(0,"option",31),n(1),i()),o&2){let e=t.$implicit;l("value",e.id),a(),S(" ",e.nombre," (",e.codigo,") ")}}function Z(o,t){o&1&&(r(0,"div",32),n(1," Producto es requerido "),i())}function ee(o,t){if(o&1&&(r(0,"option",31),n(1),i()),o&2){let e=t.$implicit;l("value",e.id),a(),S(" ",e.nombre," (",e.tipo,") ")}}function te(o,t){o&1&&(r(0,"div",32),n(1," Tipo de movimiento es requerido "),i())}function ie(o,t){o&1&&(r(0,"div",32),n(1," Cantidad es requerida y debe ser mayor a 0 "),i())}function oe(o,t){if(o&1){let e=F();r(0,"form",8),h("ngSubmit",function(){b(e);let c=f();return _(c.onSubmit())}),r(1,"div",9)(2,"div",10)(3,"label",11),n(4,"Bodega *"),i(),r(5,"select",12)(6,"option",13),n(7,"Seleccione una bodega"),i(),s(8,W,2,2,"option",14),i(),s(9,X,2,0,"div",15),i(),r(10,"div",10)(11,"label",16),n(12,"Producto *"),i(),r(13,"select",17)(14,"option",13),n(15,"Seleccione un producto"),i(),s(16,Y,2,3,"option",14),i(),s(17,Z,2,0,"div",15),i()(),r(18,"div",9)(19,"div",10)(20,"label",18),n(21,"Tipo de Movimiento *"),i(),r(22,"select",19)(23,"option",13),n(24,"Seleccione un tipo"),i(),s(25,ee,2,3,"option",14),i(),s(26,te,2,0,"div",15),r(27,"small",20),n(28," \xBFNo encuentras el tipo que necesitas? "),r(29,"a",21),n(30,"Crear nuevo tipo"),i()()(),r(31,"div",10)(32,"label",22),n(33,"Cantidad *"),i(),g(34,"input",23),s(35,ie,2,0,"div",15),i()(),r(36,"div",9)(37,"div",10)(38,"label",24),n(39,"Fecha"),i(),g(40,"input",25),i()(),r(41,"div",10)(42,"label",26),n(43,"Observaciones"),i(),g(44,"textarea",27),i(),r(45,"div",28)(46,"button",29),n(47),i(),r(48,"button",30),h("click",function(){b(e);let c=f();return _(c.onCancel())}),n(49," Cancelar "),i()()()}if(o&2){let e,m,c,v,d=f();l("formGroup",d.kardexForm),a(8),l("ngForOf",d.bodegas),a(),l("ngIf",((e=d.kardexForm.get("bodegaId"))==null?null:e.invalid)&&((e=d.kardexForm.get("bodegaId"))==null?null:e.touched)),a(7),l("ngForOf",d.productos),a(),l("ngIf",((m=d.kardexForm.get("productoId"))==null?null:m.invalid)&&((m=d.kardexForm.get("productoId"))==null?null:m.touched)),a(8),l("ngForOf",d.tiposMovimiento),a(),l("ngIf",((c=d.kardexForm.get("tipoMovimientoId"))==null?null:c.invalid)&&((c=d.kardexForm.get("tipoMovimientoId"))==null?null:c.touched)),a(9),l("ngIf",((v=d.kardexForm.get("cantidad"))==null?null:v.invalid)&&((v=d.kardexForm.get("cantidad"))==null?null:v.touched)),a(11),l("disabled",d.kardexForm.invalid||d.loading),a(),x(" ",d.loading?"Guardando...":d.isEdit?"Actualizar":"Crear"," Movimiento ")}}var J=class o{constructor(t,e,m,c,v,d,re){this.fb=t;this.kardexService=e;this.bodegaService=m;this.productoService=c;this.tipoMovimientoService=v;this.route=d;this.router=re;this.kardexForm=this.fb.group({bodegaId:["",u.required],productoId:["",u.required],tipoMovimientoId:["",u.required],cantidad:["",[u.required,u.min(.001)]],fecha:[this.getCurrentDateFormatted()],observaciones:[""]})}kardexForm;bodegas=[];productos=[];tiposMovimiento=[];loading=!1;error=null;isEdit=!1;getCurrentDateFormatted(){return new Date().toISOString().split("T")[0]}convertToDate(t){if(!t)return new Date;let e=new Date(t);return e.setHours(12,0,0,0),e}ngOnInit(){let t=this.route.snapshot.params.id;t?(this.isEdit=!0,this.loadKardex(Number(t))):this.loadCatalogos()}loadKardex(t){this.loading=!0,this.kardexService.getById(t).subscribe({next:e=>{let c=new Date(e.fecha).toISOString().split("T")[0];this.kardexForm.patchValue({bodegaId:e.bodegaId,productoId:e.productoId,tipoMovimientoId:e.tipoMovimientoId,cantidad:e.cantidad,fecha:c,observaciones:e.observaciones}),this.loadCatalogos()},error:e=>{this.error="Error al cargar movimiento",this.loading=!1,console.error(e)}})}loadCatalogos(){this.loading=!0,this.bodegaService.getAll().subscribe({next:t=>this.bodegas=t,error:t=>console.error("Error loading bodegas:",t)}),this.productoService.getAll().subscribe({next:t=>this.productos=t,error:t=>console.error("Error loading productos:",t)}),this.tipoMovimientoService.getAll().subscribe({next:t=>{this.tiposMovimiento=t,this.loading=!1,t.length===0&&(this.error="No hay tipos de movimiento configurados. Crea algunos primero.")},error:t=>{console.error("Error loading tipos movimiento:",t),this.error="Error al cargar tipos de movimiento. Verifica la conexi\xF3n.",this.loading=!1}})}onSubmit(){if(this.kardexForm.invalid)return;this.loading=!0;let t={bodegaId:Number(this.kardexForm.value.bodegaId),productoId:Number(this.kardexForm.value.productoId),tipoMovimientoId:Number(this.kardexForm.value.tipoMovimientoId),cantidad:Number(this.kardexForm.value.cantidad),fecha:this.convertToDate(this.kardexForm.value.fecha),observaciones:this.kardexForm.value.observaciones};if(this.isEdit){let e=this.route.snapshot.params.id;this.kardexService.update(Number(e),t).subscribe({next:()=>{this.router.navigate(["/kardex/list"])},error:m=>{this.error=m.error?.message||"Error al actualizar movimiento",this.loading=!1,console.error(m)}})}else this.kardexService.create(t).subscribe({next:()=>{this.router.navigate(["/kardex/list"])},error:e=>{this.error=e.error?.message||"Error al crear movimiento",this.loading=!1,console.error(e)}})}onCancel(){this.router.navigate(["/kardex/list"])}static \u0275fac=function(e){return new(e||o)(p(R),p(L),p($),p(z),p(H),p(y),p(N))};static \u0275cmp=I({type:o,selectors:[["app-kardex-form"]],decls:11,vars:4,consts:[[1,"container"],[1,"header"],["routerLink","/tipos-movimiento/nuevo",1,"btn","btn-sm","btn-primary"],["class","alert alert-error",4,"ngIf"],["class","loading",4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],[1,"alert","alert-error"],[1,"loading"],[3,"ngSubmit","formGroup"],[1,"form-row"],[1,"form-group"],["for","bodegaId"],["id","bodegaId","formControlName","bodegaId",1,"form-control"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","error",4,"ngIf"],["for","productoId"],["id","productoId","formControlName","productoId",1,"form-control"],["for","tipoMovimientoId"],["id","tipoMovimientoId","formControlName","tipoMovimientoId",1,"form-control"],[1,"help-text"],["routerLink","/tipos-movimiento/nuevo",1,"link"],["for","cantidad"],["type","number","id","cantidad","formControlName","cantidad","step","0.001","min","0.001","placeholder","0",1,"form-control"],["for","fecha"],["type","date","id","fecha","formControlName","fecha",1,"form-control"],["for","observaciones"],["id","observaciones","formControlName","observaciones","rows","3","placeholder","Observaciones adicionales del movimiento...",1,"form-control"],[1,"form-actions"],["type","submit",1,"btn","btn-primary",3,"disabled"],["type","button",1,"btn","btn-secondary",3,"click"],[3,"value"],[1,"error"]],template:function(e,m){e&1&&(r(0,"div",0)(1,"div",1)(2,"h1"),n(3),i(),r(4,"button",2),n(5," Crear Tipo de Movimiento "),i(),r(6,"p"),n(7,"Registra una nueva entrada o salida en el inventario."),i()(),s(8,Q,2,1,"div",3)(9,U,2,0,"div",4)(10,oe,50,10,"form",5),i()),e&2&&(a(3),x("",m.isEdit?"Editar":"Nuevo"," Movimiento Kardex"),a(5),l("ngIf",m.error),a(),l("ngIf",m.loading),a(),l("ngIf",!m.loading))},dependencies:[M,E,k,j,w,q,G,T,O,A,K,D,P,V,B],encapsulation:2})};export{J as KardexFormComponent};
