import{a as T}from"./chunk-EBPI7R5L.js";import{a as I,b as L,c as v,d as y,e as N,f as V,h as A,i as D,n as R,o as k,p as G}from"./chunk-UKXJF3TO.js";import"./chunk-6OBKXAVN.js";import{b as _,d as x}from"./chunk-ZN2XXCIA.js";import{Fa as b,Ja as u,Jb as S,Lb as E,Ua as c,Va as r,Wa as i,Xa as d,a as g,ab as p,b as h,bb as F,hb as n,ib as C,jb as f,ua as a,za as s}from"./chunk-CFCTFSSM.js";function j(l,o){if(l&1&&(r(0,"div",14),n(1),i()),l&2){let e=F();a(),C(e.error)}}function B(l,o){l&1&&(r(0,"div",15),n(1," C\xF3digo es requerido "),i())}var M=class l{constructor(o,e,t,m){this.fb=o;this.loteService=e;this.route=t;this.router=m;this.loteForm=this.fb.group({codigo:["",[v.required,v.maxLength(50)]],fechaVencimiento:[""],activo:[!0]})}loteForm;isEdit=!1;loading=!1;error=null;ngOnInit(){let o=this.route.snapshot.params.id;o&&(this.isEdit=!0,this.loadLote(Number(o)))}loadLote(o){this.loading=!0,this.loteService.getById(o).subscribe({next:e=>{let t=e.fechaVencimiento?new Date(e.fechaVencimiento).toISOString().split("T")[0]:"";this.loteForm.patchValue(h(g({},e),{fechaVencimiento:t})),this.loading=!1},error:e=>{this.error="Error al cargar lote",this.loading=!1,console.error(e)}})}onSubmit(){if(this.loteForm.invalid)return;this.loading=!0;let o=this.loteForm.value;if(this.isEdit){let e=this.route.snapshot.params.id;this.loteService.update(Number(e),o).subscribe({next:()=>{this.router.navigate(["/lotes"])},error:t=>{this.error=t.error?.message||"Error al actualizar lote",this.loading=!1}})}else this.loteService.create(o).subscribe({next:()=>{this.router.navigate(["/lotes"])},error:e=>{this.error=e.error?.message||"Error al crear lote",this.loading=!1}})}onCancel(){this.router.navigate(["/lotes"])}static \u0275fac=function(e){return new(e||l)(s(k),s(T),s(_),s(x))};static \u0275cmp=b({type:l,selectors:[["app-lote-form"]],decls:23,vars:6,consts:[[1,"container"],["class","alert alert-error",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"form-group"],["for","codigo"],["type","text","id","codigo","formControlName","codigo","maxlength","50",1,"form-control"],["class","error",4,"ngIf"],["for","fechaVencimiento"],["type","date","id","fechaVencimiento","formControlName","fechaVencimiento",1,"form-control"],[1,"checkbox-label"],["type","checkbox","formControlName","activo"],[1,"form-actions"],["type","submit",1,"btn","btn-primary",3,"disabled"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"alert","alert-error"],[1,"error"]],template:function(e,t){if(e&1&&(r(0,"div",0)(1,"h1"),n(2),i(),u(3,j,2,1,"div",1),r(4,"form",2),p("ngSubmit",function(){return t.onSubmit()}),r(5,"div",3)(6,"label",4),n(7,"C\xF3digo *"),i(),d(8,"input",5),u(9,B,2,0,"div",6),i(),r(10,"div",3)(11,"label",7),n(12,"Fecha de Vencimiento"),i(),d(13,"input",8),i(),r(14,"div",3)(15,"label",9),d(16,"input",10),n(17," Activo "),i()(),r(18,"div",11)(19,"button",12),n(20),i(),r(21,"button",13),p("click",function(){return t.onCancel()}),n(22," Cancelar "),i()()()()),e&2){let m;a(2),f("",t.isEdit?"Editar":"Nuevo"," Lote"),a(),c("ngIf",t.error),a(),c("formGroup",t.loteForm),a(5),c("ngIf",((m=t.loteForm.get("codigo"))==null?null:m.invalid)&&((m=t.loteForm.get("codigo"))==null?null:m.touched)),a(10),c("disabled",t.loteForm.invalid||t.loading),a(),f(" ",t.isEdit?"Actualizar":"Crear"," Lote ")}},dependencies:[E,S,G,V,L,I,y,N,R,A,D],encapsulation:2})};export{M as LoteFormComponent};
