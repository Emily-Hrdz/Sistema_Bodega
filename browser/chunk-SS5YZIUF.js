import{a as C}from"./chunk-YCMZOG5D.js";import{Fa as h,Ib as b,Ja as g,Jb as E,Lb as S,O as f,Rb as I,S as v,Ua as s,Va as r,Wa as n,bb as c,gb as A,hb as a,ib as l,jb as x,kb as p,ua as o,z as u,za as L}from"./chunk-CFCTFSSM.js";var m=class i{constructor(t){this.http=t}apiUrl=`${C.apiUrl}/audit-logs`;getAll(t=100){return this.http.get(this.apiUrl,{params:{limit:t.toString()}}).pipe(u(e=>(console.error("Error cargando auditor\xEDa:",e),this.http.get(this.apiUrl))))}getAllSimple(){return this.http.get(this.apiUrl)}static \u0275fac=function(e){return new(e||i)(v(I))};static \u0275prov=f({token:i,factory:i.\u0275fac,providedIn:"root"})};function O(i,t){if(i&1&&(r(0,"div",6),a(1),n()),i&2){let e=c();o(),l(e.error)}}function T(i,t){i&1&&(r(0,"div",7),a(1,"Cargando..."),n())}function F(i,t){i&1&&(r(0,"div",8),a(1," No hay registros de auditor\xEDa "),n())}function U(i,t){if(i&1&&(r(0,"tr")(1,"td"),a(2),n(),r(3,"td"),a(4),n(),r(5,"td")(6,"span"),a(7),n()(),r(8,"td"),a(9),n(),r(10,"td"),a(11),n(),r(12,"td"),a(13),n()()),i&2){let e=t.$implicit,d=c(2);o(2),l(d.formatDate(e.createdAt)),o(2),p("",e.user.nombre," (",e.user.email,")"),o(2),A(d.getActionClass(e.accion)),o(),x(" ",e.accion," "),o(2),p("",e.entidad," ",e.entidadId?"#"+e.entidadId:""),o(2),l(e.descripcion),o(2),l(e.ipAddress||"-")}}function N(i,t){if(i&1&&(r(0,"table",9)(1,"thead")(2,"tr")(3,"th"),a(4,"Fecha/Hora"),n(),r(5,"th"),a(6,"Usuario"),n(),r(7,"th"),a(8,"Acci\xF3n"),n(),r(9,"th"),a(10,"Entidad"),n(),r(11,"th"),a(12,"Descripci\xF3n"),n(),r(13,"th"),a(14,"IP"),n()()(),r(15,"tbody"),g(16,U,14,10,"tr",10),n()()),i&2){let e=c();o(16),s("ngForOf",e.auditLogs)}}var _=class i{constructor(t){this.auditLogService=t}auditLogs=[];loading=!1;error=null;ngOnInit(){this.loadAuditLogs()}loadAuditLogs(){this.loading=!0,this.error=null,this.auditLogService.getAll(100).subscribe({next:t=>{this.auditLogs=t,this.loading=!1,console.log("Auditor\xEDa cargada:",t)},error:t=>{console.error("Error detallado:",t),this.error=`Error al cargar auditor\xEDa: ${t.status} ${t.statusText}`,this.loading=!1,this.loadAuditLogsSimple()}})}loadAuditLogsSimple(){this.auditLogService.getAllSimple().subscribe({next:t=>{this.auditLogs=t,this.loading=!1},error:t=>{this.error="No se pudo cargar la auditor\xEDa. Verifica que el endpoint exista.",this.loading=!1}})}formatDate(t){return new Date(t).toLocaleString("es-ES")}getActionClass(t){switch(t.toUpperCase()){case"CREATE":return"badge-success";case"UPDATE":return"badge-warning";case"DELETE":return"badge-danger";case"LOGIN":return"badge-info";default:return"badge-secondary"}}static \u0275fac=function(e){return new(e||i)(L(m))};static \u0275cmp=h({type:i,selectors:[["app-audit-logs-list"]],decls:8,vars:4,consts:[[1,"container"],[1,"header"],["class","alert alert-error",4,"ngIf"],["class","loading",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","table",4,"ngIf"],[1,"alert","alert-error"],[1,"loading"],[1,"empty-state"],[1,"table"],[4,"ngFor","ngForOf"]],template:function(e,d){e&1&&(r(0,"div",0)(1,"div",1)(2,"h1"),a(3,"Auditor\xEDa del Sistema"),n()(),g(4,O,2,1,"div",2)(5,T,2,0,"div",3)(6,F,2,0,"div",4)(7,N,17,1,"table",5),n()),e&2&&(o(4),s("ngIf",d.error),o(),s("ngIf",d.loading),o(),s("ngIf",!d.loading&&d.auditLogs.length===0),o(),s("ngIf",!d.loading&&d.auditLogs.length>0))},dependencies:[S,b,E],encapsulation:2})};export{_ as AuditLogsListComponent};
